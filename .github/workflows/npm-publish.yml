# ğŸš€ Workflow name shown in GitHub Actions
name: Publish to NPM

# ğŸ·ï¸ Trigger the workflow when a version tag is pushed
# Example tags: v1.0.0, v2.3.4
on:
  push:
    tags:
      - 'v*.*.*'

# ğŸ§© Define all jobs in this workflow
jobs:
  # ğŸ“¦ Job responsible for building and publishing the package
  publish:
    # ğŸ§ Run on GitHub's latest Ubuntu runner
    runs-on: ubuntu-latest

    # ğŸªœ Steps run one-by-one in order
    steps:
      # ğŸ“¥ Clone the repository into the runner
      - uses: actions/checkout@v4

      # ğŸŸ¢ Setup Node.js environment
      # - Uses Node.js v20
      # - Points npm to the official registry
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          registry-url: https://registry.npmjs.org

      # ğŸ“¦ Install pnpm package manager
      # - Ensures consistent pnpm version across CI
      - uses: pnpm/action-setup@v3
        with:
          version: 9

      # ğŸ“š Install dependencies
      # --frozen-lockfile prevents accidental dependency changes
      - run: pnpm install --frozen-lockfile

      # ğŸ› ï¸ Build the library before publishing
      - run: pnpm build

      # ğŸš€ Publish the package to NPM
      # --access public â†’ makes the package public
      # --no-git-checks â†’ skips git validation in CI
      - run: pnpm --access public --no-git-checks
        env:
          # ğŸ” Secure NPM token stored in GitHub Secrets
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
